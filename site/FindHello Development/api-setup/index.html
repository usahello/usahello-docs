<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://docs.usahello.org/FindHello%20Development/api-setup/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>API setup - USAHello Docs</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "API setup";
        var mkdocs_page_input_path = "FindHello Development/api-setup.md";
        var mkdocs_page_url = "/FindHello%20Development/api-setup/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> USAHello Docs
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../documentation-setup/">Documentation setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../outage-response/">OUTAGE RESPONSE</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">FindHello Development</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../">Overview</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">API setup</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#clone-the-repo">Clone the repo</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#download-geo-database">Download Geo database</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#environment-variables">Environment variables</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#docker-setup">Docker setup</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#docker-issues">Docker issues</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#resetting-the-database">Resetting the database</a>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#manual-setup">Manual setup</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#virtualenv">Virtualenv</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#postgres">Postgres</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#python">Python</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../app-setup/">App setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../mobile-setup/">Mobile setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../solr-setup/">Solr setup</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">FindHello Deployment</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../FindHello%20Deployment/">Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FindHello%20Deployment/server-setup/">Server setup</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FindHello%20Deployment/web-deploy/">Web app deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FindHello%20Deployment/mobile-deploy/">Mobile app deployment</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FindHello%20Deployment/solr-setup/">Solr setup</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">FindHello Other</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../FindHello%20Other/analytics/">Analytics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FindHello%20Other/arabic-translations/">Arabic Translations</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../FindHello%20Other/search/">Search</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">USAHello Docs</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>FindHello Development &raquo;</li>
      <li>API setup</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/usahello/usahello-docs/edit/master/docs/FindHello Development/api-setup.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="api-setup">API Setup</h1>
<p>The Django app can be setup either manually (installing Python, <code>virtualenv</code>, Postgres etc.) or using Docker. </p>
<h2 id="prerequisites">Prerequisites</h2>
<p>Before setting up the project, there's a few things you need to do first.</p>
<h3 id="clone-the-repo">Clone the repo</h3>
<p>The first step is to clone the repo to you machine: </p>
<pre><code class="language-sh">git clone git@bitbucket.org:findhello/find-hello-api.git 
cd find-hello-api
</code></pre>
<h3 id="download-geo-database">Download Geo database</h3>
<p>The API uses <a href="https://docs.djangoproject.com/en/2.1/ref/contrib/gis/">GeoDjango</a> which is an optional library within the Django ecosystem for dealing with GIS. We need a geo database to use GeoDjango so this step downloads this database.</p>
<p>Visit <a href="https://dev.maxmind.com/geoip/geoip2/geolite2/">this page</a> and download "GeoLite2 City" (Maxmind DB format) database and unzip it. Create a <code>geofiles/</code> directory
in the root of the repo and place the <code>.mmdb</code> in there so that the path is <code>geofiles/GeoLite2-City.mmdb</code></p>
<h3 id="environment-variables">Environment variables</h3>
<p>Create a <code>.env</code> in the root of the repo with the following:</p>
<pre><code class="language-sh">DJANGO_SECRET_KEY=&quot;secret&quot;
DATABASE_URL=postgresql://find_hello_api:find_hello_api@localhost/find_hello_api
</code></pre>
<hr />
<h2 id="docker-setup">Docker setup</h2>
<p>Make sure you have <a href="https://docs.docker.com/install/">Docker installed on your machine</a>. On Ubuntu this should
be easy:</p>
<pre><code class="language-sh">sudo apt-get install docker docker-compose
</code></pre>
<p>On Windows of Mac, you need to install the Docker desktop pacakges from here:</p>
<ul>
<li>https://docs.docker.com/engine/installation/</li>
</ul>
<p>First build the Docker images (this will take a while):</p>
<pre><code class="language-sh">docker-compose -f local.yml build
</code></pre>
<p>then start the Docker containers:</p>
<pre><code class="language-sh">docker-compose -f local.yml up
</code></pre>
<p>This should automatically start everything required to work on the site.</p>
<p>Launch the browser at:</p>
<pre><code class="language-sh">http://localhost:8000
</code></pre>
<p>Setup a new user and load some fixtures:</p>
<pre><code>docker-compose -f local.yml run --rm django python manage.py createsuperuser
docker-compose -f local.yml run --rm django python manage.py loaddata find_hello/location/fixtures/categories.json
docker-compose -f local.yml run --rm django python manage.py loaddata find_hello/location/fixtures/groups.json
</code></pre>
<h3 id="docker-issues">Docker issues</h3>
<h4 id="resetting-the-database">Resetting the database</h4>
<p>If you have any issues with the database that Docker creates, you can reset it:</p>
<pre><code class="language-sh">docker-compose -f local.yml down
docker volume rm find-hello-api_postgres_backup_local
docker volume rm  find-hello-api_postgres_data_local
docker-compose -f local.yml up --build
docker-compose -f local.yml run --rm django python manage.py createsuperuser
docker-compose -f local.yml run --rm django python manage.py loaddata find_hello/location/fixtures/categories.json
docker-compose -f local.yml run --rm django python manage.py loaddata find_hello/location/fixtures/groups.json
</code></pre>
<hr />
<h2 id="manual-setup">Manual setup</h2>
<p>Docker can be hard to work with at times, making it difficult to debug issues. An alternative is to run the app natively on your machine instead of with Docker containers.</p>
<p>This assumes that you have Python 3 installed on your machine. The following steps are for MacOS.</p>
<h3 id="virtualenv">Virtualenv</h3>
<p>Install <code>virtualenv</code> and <code>virtualenvwrapper</code>. These are Python apps that allow you to set up isolated Python environments, a bit like a rudimentary Docker but for Python.</p>
<pre><code class="language-sh">&gt; pip3 install virtualenv virtualenvwrapper
</code></pre>
<p>and add the following to the top of your <code>~/.bashrc</code> to configure virtualenv:</p>
<pre><code>export WORKON_HOME=$HOME/.virtualenvs
source /usr/local/bin/virtualenvwrapper.sh
</code></pre>
<p>and create a new virtualenv for the API:</p>
<pre><code class="language-sh">&gt; mkvirtualenv find-hello-api --python=python3
</code></pre>
<p>To "activate" the virtualenv use the following command:</p>
<pre><code class="language-sh">&gt; cdvirtualenv find-hello-api
</code></pre>
<p>and to "deactivate" (so that you revert to using the system Python) use (although don't do this now, as you need to have your new virtualenv activated):</p>
<pre><code class="language-sh">&gt; deactivate
</code></pre>
<h2 id="postgres">Postgres</h2>
<p>You will need to have an instance of Postgres <strong>9.6</strong> database set up locally on your machine. For MacOS, the easiest option is to use <code>Postgres.app</code>. Alternatively you can install Postgres with <code>brew</code> (but you need to make sure it's 9.6).</p>
<p>You will also need PostGIS available (which adds GIS support to the Postgresql database). So, if you've installed Postgres via brew, then you will also need:</p>
<pre><code class="language-sh">&gt; brew install postgis gdal libgeoip
</code></pre>
<p>If you've installed Postgres.app, it should already have PostGIS included. </p>
<p>Create a database:</p>
<pre><code class="language-sh">&gt; psql
</code></pre>
<pre><code class="language-sql">&gt; create database find_hello_api;
&gt; create user find_hello_api with password 'find_hello_api';
&gt; grant all privileges on database find_hello_api to find_hello_api;
&gt; \c find_hello_api
&gt; create extension postgis;
&gt; create extension fuzzystrmatch;
&gt; create extension postgis_tiger_geocoder;
</code></pre>
<h2 id="python">Python</h2>
<p>First you need to add the repo to the Python path. Add the entire repo to the path using:</p>
<pre><code class="language-sh">&gt; add2virtualenv /path/to/where/you/git/clones/find-hello-api
</code></pre>
<p>and reactivate:</p>
<pre><code>&gt; workon find-hello-api 
</code></pre>
<p>Install all requirements:</p>
<pre><code class="language-sh">&gt; pip install -r requirements/local.txt
</code></pre>
<p>Set up the database:</p>
<pre><code class="language-sh">&gt; python manage.py migrate
</code></pre>
<p>And create a new superuser:</p>
<pre><code class="language-sh">&gt; python manage.py createsuperuser
</code></pre>
<p>Load some fixtures:</p>
<pre><code class="language-sh">&gt; python manage.py loaddata find_hello/location/fixtures/categories.json
&gt; python manage.py loaddata find_hello/location/fixtures/groups.json
</code></pre>
<p>And run the development server:</p>
<pre><code class="language-sh">python manage.py runserver
</code></pre>
<p>You will now be able to see the API via <a href="http://localhost:8000">http://localhost:8000</a> and the admin dashboard via <a href="http://localhost:8000/admin-dashboard/">http://localhost:8000/admin-dashboard/</a></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../" class="btn btn-neutral float-left" title="Overview"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../app-setup/" class="btn btn-neutral float-right" title="App setup">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/usahello/usahello-docs" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../app-setup/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
